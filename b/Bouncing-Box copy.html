<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Realistic Bouncing Box</title>
  <style>
    canvas {
      border: 1px solid #000;
      background: #f3eaff;
    }

    select {
      margin-top: 10px;
      font-size: 16px;
    }
  </style>
</head>

<body>

  <canvas id="canvas" width="300" height="400"></canvas>
  <br>
  <select id="physicsSelect">
    <option value="realistic">Realistic</option>
    <option value="arcade">Arcade</option>
    <option value="cartoon">Cartoon</option>
    <option value="slowmo">Slow Motion</option>
    <option value="chaos">Chaos Mode</option>
  </select>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const physicsSelect = document.getElementById('physicsSelect');

    const floorY = 350;
    const restitution = 0.6;

    let box = {
      x: canvas.width / 2 - 20,
      y: 80,
      width: 40,
      height: 40,
      velocityX: 1,
      velocityY: 0,
      gravity: 0.6,
      gravityModifier: 1,
      angle: 0,
      rotateSpeed: 0.05
    };

    function setPhysics(mode) {
      switch (mode) {
        case "realistic":
          box.gravity = 0.6;
          box.gravityModifier = 1;
          break;
        case "arcade":
          box.gravity = 0.5;
          box.gravityModifier = 1;
          break;
        case "cartoon":
          box.gravity = 0.4;
          box.gravityModifier = 0.7;
          break;
        case "slowmo":
          box.gravity = 0.3;
          box.gravityModifier = 0.3;
          break;
        case "chaos":
          box.gravity = 0.8;
          box.gravityModifier = 1.3;
          box.velocityX = Math.random() * 4 - 2;
          box.rotateSpeed = Math.random() * 0.4 - 0.2;
          break;
      }
    }

    physicsSelect.addEventListener('change', () => {
      resetBox();
      setPhysics(physicsSelect.value);
    });

    function resetBox() {
      box.x = canvas.width / 2 - 20;
      box.y = 50;
      box.velocityY = 0;
      box.angle = 0;
      box.rotateSpeed = 0.05;
      box.velocityX = 1;
    }

    let isTouchingFloor = false;

    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw floor line
      ctx.strokeStyle = 'red';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(0, floorY);
      ctx.lineTo(canvas.width, floorY);
      ctx.stroke();

      // Apply gravity
      box.velocityY += box.gravity * box.gravityModifier;
      box.y += box.velocityY;
      box.x += box.velocityX;
      box.angle += box.rotateSpeed;

      box.velocityX *= 0.98;
      box.rotateSpeed *= 0.98;

      // Estimate lower bound with rotation (approximate)
      const rotationOffset = Math.abs(Math.sin(box.angle) + Math.cos(box.angle)) * (box.height / 2);
      const centerY = box.y + box.height / 2;
      const bottomY = centerY + rotationOffset;

      // Collision with floor

      if (bottomY >= floorY) {
        const correction = bottomY - floorY;
        box.y -= correction;

        box.velocityY *= -restitution;

        if (Math.abs(box.velocityY) < 0.5) {
          box.velocityY = 0;
        }

        box.rotateSpeed *= 0.9;

        if (!isTouchingFloor) {
          console.log(box.x + box.width / 2, box.y + box.height / 2)
          console.log("Box menyentuh lantai");
          isTouchingFloor = true;
        }
      } else {
        isTouchingFloor = false;
      }
      // Wall collision
      if (box.x <= 0 || box.x + box.width >= canvas.width) {
        box.velocityX *= -1;
      }

      // Draw rotating box
      ctx.save();
      // 
      ctx.translate(box.x + box.width / 2, box.y + box.height / 2);
      // console.log(box.angle)
      // ctx.rotate(box.angle);
      ctx.fillStyle = "yellow";
      ctx.fillRect(-box.width / 2, -box.height / 2, box.width, box.height);
      ctx.restore();

      requestAnimationFrame(update);
    }
    ctx.strokeStyle = 'red';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(0, floorY);
    ctx.lineTo(canvas.width, floorY);
    ctx.stroke();
    ctx.save();
    // 
    ctx.translate(190, 328);
    // console.log(box.angle)
    // ctx.rotate(box.angle);
    ctx.fillStyle = "yellow";
    ctx.fillRect(-box.width / 2, -box.height / 2, box.width, box.height);
    ctx.restore();

    setPhysics("realistic");
    // update();
  </script>

</body>

</html>